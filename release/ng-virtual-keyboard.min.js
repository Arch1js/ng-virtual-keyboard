!function(e){!function(e){var t="keyboard",n={text:"",alt:[],name:""};e[t]=function(a,o){var r,c,u=this,a=(e(document.createElement("div")),a),l=e(a),s={elements:{keyboard:'<div class="keyboard"></div>',row:'<ul class="keyboard-row"></ul>',key:'<li class="keyboard-key"></li>',alt:'<ul class="keyboard-alt"></ul>',altKey:'<li class="keyboard-alt-key"></li>'},altDelay:500,classPrefix:"keyboard",keyboard:[],plugin:function(e){e[t]("bind","print",function(e,t){console.log(t.text)})}},d={},f=0/0,p=[],g=!1,y=!1,m=function(n){d=e.extend({},s,o),"object"!=typeof d.plugin&&(d.plugin=[d.plugin]),r=e(d.elements.keyboard).appendTo(l),u.methods.keyboard(d.keyboard),e(document).bind("mouseup."+t,function(){b()});for(i in d.plugin)u.methods.plug(d.plugin[i])},b=function(e,t){if(c&&(c.removeClass(d.classPrefix+"-held"),c=null,clearTimeout(f),f=0/0,"undefined"!=typeof e)){"undefined"==typeof t&&(t=!1);var n=t!==!1?g?e.cap.alt[t]:e.alt[t]:g?e.cap.text:e.text;e.action===!1||e.action&&e.action(l)===!1||(C("print",{key:e,cap:g,alt:t,text:n}),!y&&g&&u.methods.capToggle()),C("release",{key:e,cap:g,alt:t,text:n})}},k=function(e){return"number"==typeof e&&e===Math.round(e)},x=function(e){r.html(""),p=[];for(i in e)u.methods.addRow(e[i])},h=function(e){for(var t=p.length;e>=t;)p.push([]),r.append(d.elements.row),t++},v=function(a,o){if("object"!=typeof o&&(o={text:o}),o=e.extend({},n,o),"object"!=typeof o.cap&&(o.cap="undefined"!=typeof o.cap?{text:o.cap}:{}),"undefined"==typeof o.cap.alt){o.cap.alt=[];for(var i in o.alt)o.cap.alt[i]=o.alt[i].toUpperCase()}"undefined"==typeof o.cap.text&&(o.cap.text=o.text.toUpperCase()),p[a].push(o);var u=e(d.elements.key).appendTo(r.children(":eq("+a+")"));u.data(t+"-key",o),u.text(g?o.cap.text:o.text),o.name&&u.addClass(d.classPrefix+"-key-"+o.name),w(u),u.bind("mouseup."+t,function(){c&&b(o)}),u.bind("mousedown."+t,function(){c=u,f=setTimeout(function(){u.addClass(d.classPrefix+"-held")},d.altDelay)})},w=function(n){var a=n.data(t+"-key");if(a.alt){var o=e(d.elements.alt).appendTo(n);for(var r in a.alt){var i=e(d.elements.altKey).appendTo(o);i.data(t+"-key",a),i.data(t+"-alt",r),i.text(g?a.cap.alt[r]:a.alt[r]),i.bind("mouseup."+t,function(){b(e(this).data(t+"-key"),e(this).data(t+"-alt"))})}}},S=function(){for(var e in p){var t=r.children(":eq("+e+")");for(j in p[e]){var n=p[e][j],a=t.children(":eq("+j+")");a.text(g?n.cap.text:n.text),w(a)}}},C=function(){return arguments[0]=t+"-"+arguments[0],l.trigger.apply(l,arguments),a};u.methods={bind:function(){return arguments[0]=t+"-"+arguments[0],l.bind.apply(l,arguments),a},addRow:function(e){row=p.length,h(row);for(var t in e)v(row,e[t]);return a},addKeys:function(e,t){if(k(e)){p[e]||h(e);for(var n in t)v(e,t[n])}return a},addKey:function(e,t){return k(e)&&(p[e]||h(e),v(e,t)),a},plug:function(n){"string"==typeof n&&(n=e[t].plugins[n]),"function"==typeof n&&n(l)},capToggle:function(e){return g=!g,y=Boolean(e)&&g,g&&y?(l.addClass("keyboard-capsLocked"),l.removeClass("keyboard-caps")):g?(l.addClass("keyboard-caps"),l.removeClass("keyboard-capsLocked")):(l.removeClass("keyboard-caps"),l.removeClass("keyboard-capsLocked")),S(),a},cap:function(e){return g=!0,y=Boolean(e),g&&y?(l.addClass("keyboard-capsLocked"),l.removeClass("keyboard-caps")):(l.addClass("keyboard-caps"),l.removeClass("keyboard-capsLocked")),S(),a},unCap:function(){return g=!1,y=!1,l.removeClass("keyboard-caps"),l.removeClass("keyboard-capsLocked"),S(),a},keyboard:function(n){return"string"==typeof n&&(n=e[t].keyboards[n]),"object"==typeof n&&x(n),r}},l.data(t,u),m()},e[t].keyboards={},e[t].plugins={},e.fn[t]=function(n){var a=arguments,o=this;return this.each(function(){var i=e(this);if(void 0==(c=i.data(t)))var c=new e[t](this,n);return c.methods[n]&&(r=c.methods[n].apply(c,Array.prototype.slice.call(a,1)))!==this?(o=r,!1):void 0}),o}}(jQuery),function(e){e.keyboard.keyboards.azerty=[["@","1","2","3","4","5","6","7","8","9","0",{text:"⌫",name:"backSpace",action:function(e){return!1}}],[{text:"⇥",cap:{text:"⇤"},name:"tab",action:!1},{text:"a",alt:["à"]},"z",{text:"e",alt:["é","è","ê"]},"r","t","y",{text:"u",alt:["ù"]},"i","o","p",{text:"⏎",name:"return",action:!1}],[{text:"⇪",name:"capsLock",action:function(e){return e.keyboard("capToggle",!0),!1}},"q","s","d","f","g","h","j","k","l","m"],[{text:"⇧",name:"leftShift",action:function(e){return e.keyboard("capToggle"),!1}},"w","x","c","v","b","n",{text:",",alt:[":",";"]},{text:".",alt:["?","!",";"]},"'",{text:":)",alt:[";)","X)","8)",":("]},{text:"⇧",name:"rightShift",action:function(e){return e.keyboard("capToggle"),!1}}],[{text:" ",name:"space"},{text:"←",action:!1,name:"leftArrow"},{text:"→",action:!1,name:"rightArrow"}]]}(jQuery),function(e){e.keyboard.keyboards.qwerty=[["@","1","2","3","4","5","6","7","8","9","0",{text:"⌫",name:"backSpace",action:function(e){return!1}}],[{text:"⇥",cap:{text:"⇤"},name:"tab",action:!1},"q","w","e","r","t","y","u","i","o","p",{text:"⏎",name:"return",action:!1}],[{text:"⇪",name:"capsLock",action:function(e){return e.keyboard("capToggle",!0),!1}},"a","s","d","f","g","h","j","k","l",{text:",",alt:[":",";"]}],[{text:"⇧",name:"leftShift",action:function(e){return e.keyboard("capToggle"),!1}},"z","x","c","v","b","n","m",{text:".",alt:["?","!",";"]},"'",{text:":)",alt:[";)","X)","8)",":("]},{text:"⇧",name:"rightShift",action:function(e){return e.keyboard("capToggle"),!1}}],[{text:" ",name:"space"},{text:"←",action:!1,name:"leftArrow"},{text:"→",action:!1,name:"rightArrow"}]]}(jQuery),function(e){e.keyboard.plugins.form=function(t){var n=null,a=null,o=500,r=!1,i=t.keyboard("keyboard"),c=function(e){n=e,a=!1,r||(i.stop(!0,!0).slideDown(),r=!0)},u=function(e){e.get(0)===n.get(0)&&(a=!0,setTimeout(function(){a&&(n=null,r&&(i.stop(!0,!0).slideUp(),r=!1))},o))};t.keyboard("bind","print",function(e,t){n&&n.selection().replace(t.text)}),t.keyboard("bind","release",function(t,a){if(null!==n){if("tab"===a.key.name){if(newInput=e(a.cap?":input:eq("+(e(":input").index(n)-1)+")":":input:eq("+(e(":input").index(n)+1)+")"),!newInput.length)return n.trigger("blur");n=newInput}else if("enter"===a.key.name){var o=n.parents("form");o.length()>0&&o.submit()}else"backSpace"===a.key.name?n.selection().length()?n.selection().clear():n.selection().set(n.selection().start()-1,1).clear():"leftArrow"===a.key.name?n.selection().set(n.selection().start()-1,0):"rightArrow"===a.key.name&&n.selection().set(n.selection().start()+1,0);n.trigger("focus")}}),e('input[type!="submit"],textarea').live("focus",function(t){c(e(t.target))}),e('[type="text"],textarea').bind("blur.keyboard",function(t){u(e(t.target))}),i.attr("tabindex")||n&&i.attr("tabindex","0"),i.bind("focus",function(){n.trigger("focus")}).bind("mousedown.keyboard",function(){return a=!1,!1}).hide()}}(jQuery),function(e){function t(e){return"selectionStart"in e?e.selectionStart:"getSelection"in document?e.ownerDocument.getSelection().rangeCount?e.ownerDocument.getSelection().getRangeAt(0).startOffset:e.innerText.length:void("selection"in document&&console.log("IE"))}function n(e,t){if("selectionStart"in e)return e.selectionStart=t;if("getSelection"in document){var n=e.ownerDocument.getSelection(),o=document.createRange(),r=a(e);n.removeAllRanges(),o.setStart(e.firstChild,t),o.setEnd(e.firstChild,r),n.addRange(o)}else"selection"in document&&console.log("IE")}function a(e){return"selectionStart"in e?e.selectionEnd:"getSelection"in document?e.ownerDocument.getSelection().rangeCount?e.ownerDocument.getSelection().getRangeAt(0).endOffset:e.innerText.length:void("selection"in document&&console.log("IE"))}function o(e,n){if("selectionStart"in e)return e.selectionEnd=n;if("getSelection"in document){var a=e.ownerDocument.getSelection(),o=document.createRange(),r=t(e);a.removeAllRanges(),o.setStart(e.firstChild,r),o.setEnd(e.firstChild,n),a.addRange(o)}else"selection"in document&&console.log("IE")}function r(e){return a(e)-t(e)}function i(e,n){o(e,t(e)+n)}function c(e,t,a,r){n(e,t),r?o(e,a):i(e,a)}function u(n,o){var r,i=e(n);i.is("input,textarea")?(r=i.val(),i.val(r.substring(0,t(n))+o+r.substring(a(n)))):(r=i.text(),console.log(t(n)),i.text(r.substring(0,t(n))+o+r.substring(a(n))))}e.fn.selection=function(e){var l=this.jquery?this.get(0):this;return{start:function(e){return"undefined"!=typeof e?(n(l,e),this):t(l)},end:function(e){return"undefined"!=typeof e?(o(l,e),this):a(l)},length:function(e){return"undefined"!=typeof e?(i(l,e),this):r(l)},set:function(e,t,n){return c(l,e,t,n),this},clear:function(){this.replace("")},replace:function(e){var n=t(l);return u(l,e),c(l,n+e.length,0),this},before:function(e){var n=t(l);i(l,0),u(l,e),c(l,n+e.length,0)},after:function(e){var t=a(l);c(l,t,0),u(l,e),c(l,t+e.length,0)}}}}(jQuery),e.module("ng-virtual-keyboard",[]).constant("NGVK_CONFIG",{keyboard:"qwerty",plugin:"form"}).service("ngVirtualKeyboardService",["NGVK_CONFIG",function(e){return{attach:function(t,n,a){n=n||{},n.keyboard=n.keyboard||e.keyboard,n.plugin=n.plugin||e.plugin,$("body").keyboard(n)}}}]).directive("ngVirtualKeyboard",["ngVirtualKeyboardService","$timeout","$injector",function(e,t,n){return{restrict:"A",require:"?ngModel",scope:{config:"=ngVirtualKeyboard"},link:function(n,a,o,r){r&&e.attach(a[0],n.config,function(){t(function(){r.$setViewValue(a[0].value)})})}}}])}(angular);